# Fix Report: FIX-008 — Fix 08-app-pages-layout findings

**Date:** 2026-02-15T12:27:06Z
**Verification:** pnpm lint + pnpm test passed

---

## Findings addressed

### [HIGH] Finding #1: Route error boundary displays raw `error.message` to users (information disclosure)

**File:** `apps/web/src/app/error.tsx`

**Lines:** 16-23

**Description:** The route-level error UI renders `error.message` directly into the page. This can disclose internal implementation details (upstream error strings, internal route names, stack-adjacent messages, misconfiguration hints) to end users.

**Fix applied:** Addressed (verification passed).

---

### [HIGH] Finding #2: Global error boundary displays raw `error.message` to users (information disclosure)

**File:** `apps/web/src/app/global-error.tsx`

**Lines:** 10-19

**Description:** The global error UI also renders `error.message` directly. Global errors commonly come from root layout / framework-level failures, where messages are more likely to include internal details.

**Fix applied:** Addressed (verification passed).

---

### [MEDIUM] Finding #3: Error-message extraction relies on `instanceof Error`, risking poor/incorrect user output

**File:** `apps/web/src/app/error.tsx`

**Lines:** 16-16

**Description:** The UI assumes `error` is an `Error` instance at runtime and falls back to `String(error)` otherwise. If `error` is not a real `Error` instance (e.g., unusual serialization/transport cases or non-Error throws), `String(error)` can render as `"[object Object]"`, creating an unhelpful and confusing error display.

**Fix applied:** Addressed (verification passed).

---

### [MEDIUM] Finding #4: Client-side logging of full error object can leak internals in production consoles

**File:** `apps/web/src/app/error.tsx`

**Lines:** 12-14

**Description:** The route error boundary logs the full `error` object to the browser console for every error render. Depending on how errors are created/thrown, this can include stacks, nested causes, or other internal details.

**Fix applied:** Addressed (verification passed).

---

### [MEDIUM] Finding #5: Homepage copy promises a 4-step flow, but app-level wiring only renders the import feature

**File:** `apps/web/src/app/page.tsx`

**Lines:** 12-27

**Description:** The page presents an explicit “Import → Preview → Matching → Export” flow, but at the app-route level it only renders `SetlistImportView`. There is no top-level composition that visibly wires “matching” or “export” into the route. If those steps exist, they’re hidden behind (and coupled to) the import feature; if they don’t, the page copy is misleading.

**Fix applied:** Addressed (verification passed).

---

### [MEDIUM] Finding #6: No route-level loading boundary or explicit loading UI at the app-page/layout layer

**File:** `apps/web/src/app/page.tsx`

**Lines:** 3-28

**Description:** The root route renders a feature component directly with no Suspense boundary or app-page-level loading UI. If the user experience depends on async work (fetching setlists, preparing preview state, initializing MusicKit authorization flows, etc.), the route-level UX can degrade into abrupt content jumps or “nothing happens” periods, depending on how nested components behave.

**Fix applied:** Addressed (verification passed).

---

### [MEDIUM] Finding #7: Root layout unconditionally loads third-party MusicKit script with `beforeInteractive` (perf/availability risk; potential “layout flash”)

**File:** `apps/web/src/app/layout.tsx`

**Lines:** 22-27

**Description:** The root layout loads MusicKit from Apple’s CDN on every page view and does so using `strategy="beforeInteractive"`. This can increase the critical path (network dependency before interactivity) and makes core UX dependent on third-party script availability even when the current screen may not yet need MusicKit.

**Fix applied:** Addressed (verification passed).

---

### [MEDIUM] Finding #8: Global error UI bypasses root layout head/styles (unstyled/inconsistent crash experience)

**File:** `apps/web/src/app/global-error.tsx`

**Lines:** 13-34

**Description:** The global error component returns its own `<html>`/`<body>` without any `<head>` content and without importing global CSS. This means that on a global crash, users will likely see a different (unstyled or partially styled) experience than the rest of the app, and layout-level metadata (theme-color meta, manifest link generation behavior, etc.) won’t apply consistently during the failure state.

**Fix applied:** Addressed (verification passed).

---

### [LOW] Finding #9: Root layout mixes `metadata` API with manual `<head>` markup (risk of drift/duplication)

**File:** `apps/web/src/app/layout.tsx`

**Lines:** 5-20

**Description:** The layout uses the `metadata` export (title/description/manifest) but also manually injects `<head>` with a theme-color meta tag. This split increases the risk that head concerns drift over time (e.g., some head tags managed in `metadata`, others manually), and can lead to duplication if theme/viewport metadata is later added via Next’s metadata APIs.

**Fix applied:** Addressed (verification passed).

---

### [LOW] Finding #10: Error boundary types include `digest` but the UI ignores it entirely (reduced diagnosability)

**File:** `apps/web/src/app/error.tsx`

**Lines:** 9-10

**Description:** The `error` type includes an optional `digest`, but the component neither displays it nor uses it for correlation. This appears to be an unused capability and can make debugging production-only failures harder.

**Fix applied:** Addressed (verification passed).

---

### [LOW] Finding #11: Extensive inline styling in the root page suggests placeholder/prototype-level presentation

**File:** `apps/web/src/app/page.tsx`

**Lines:** 5-26

**Description:** The main page UI is primarily styled via inline style objects (layout sizing, spacing, list indentation). This looks like scaffolding/prototype UI rather than a cohesive layout system, and makes consistent theming and reuse harder.

**Fix applied:** Addressed (verification passed).

---

### [LOW] Finding #12: Minor UI slop in global error reset handler (unnecessary wrapper)

**File:** `apps/web/src/app/global-error.tsx`

**Lines:** 20-23

**Description:** The reset handler is wrapped in an arrow function even though `reset` already matches the expected callback signature.

**Fix applied:** Addressed (verification passed).

---


*Report generated by ralph-fix.sh after verification passed.*
